<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Contiv on Kubeadm Cluster">

    <link rel="shortcut icon" href="/assets/images/favicon.png">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <title>Contiv on Kubeadm Cluster - Contiv</title>

    <link href="/assets/stylesheets/application-ffbab1f8.css" rel="stylesheet"/>

    <!--[if lt IE 9]><script src="/assets/javascripts/html5shiv-099439cc.js"></script><script src="/assets/javascripts/respond.min-1eb35b04.js"></script><![endif]-->

    
  </head>

  <body id="page-Contiv on Kubeadm Cluster" class=" page-Contiv on Kubeadm Cluster layout-documents page-sub">

  <div class="navbar-jumbotron">
    <nav class="navbar navbar-inverse navbar-static-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/" style="color:$white"><img src="/assets/images/contivicon4-fb7a06d8.png" height="32px" width="32px" alt="Contiv logo"></a>
        </div>
        <div class="collapse navbar-collapse" id="navbar">
          <ul class="nav navbar-nav navbar-right main-nav">
            <li><a href="/documents/">Docs</a></li>
            <li><a href="https://github.com/contiv/install/releases" target="_blank">Download</a></li>
             <li><a href="/documents/support/index.html">Support</a></li>
            <li><a href="http://blogs.cisco.com/tag/contiv" target="_blank">Blog</a></li>
            
            <li><a href="https://github.com/contiv" target="_blank"><i class="fa fa-github"></i></a></li>
            <li><a href="https://contiv.herokuapp.com/" target="_blank"><i class="fa fa-slack"></i></a></li>
          </ul>
        </div>
      </div>
    </nav>
  </div>


<div class="sidebar-overlay"></div>


<aside id="sidebar" class="sidebar sidebar-default sidebar-fixed-right" role="navigation">
    
    <div class="sidebar-header header-cover">
        
        <div class="sidebar-image">
            <img src="/assets/images/logo3-a96fcb82.png" width="49px" height="56px">
        </div>
    </div>

    
    <ul class="main nav sidebar-nav">
        <li class="first"><a href="/intro/index.html">Intro</a></li>
        <li class=""><a href="/docs/index.html">Docs</a></li>
    </ul>
    <div class="divider"></div>
    
    <ul class="external nav sidebar-nav">
        <li class=""><a class="v-btn gray sml" href="https://github.com/contiv"><svg id="svg-download" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14" style="enable-background:new 0 0 14 14;">
  <style>
  </style>
  <path class="" d="M13,0H1C0.5,0,0,0.5,0,1v12c0,0.5,0.5,1,1,1h4.7c0,0,0,0,0-0.1c0-0.2,0-0.6,0-1.1c-1.8,0.4-2.2-0.9-2.2-0.9
    c-0.3-0.8-0.7-1-0.7-1c-0.6-0.4,0-0.4,0-0.4c0.7,0,1,0.7,1,0.7c0.6,1,1.5,0.7,1.9,0.5c0.1-0.4,0.2-0.7,0.4-0.9c-1.5-0.2-3-0.7-3-3.2
    c0-0.7,0.3-1.3,0.7-1.8C3.7,5.8,3.5,5.1,3.9,4.2c0,0,0.6-0.2,1.8,0.7c0.5-0.1,1.1-0.2,1.6-0.2c0.6,0,1.1,0.1,1.6,0.2
    c1.3-0.8,1.8-0.7,1.8-0.7c0.4,0.9,0.1,1.6,0.1,1.7c0.4,0.5,0.7,1,0.7,1.8c0,2.5-1.5,3.1-3,3.2C8.7,11.1,9,11.5,9,12.1
    c0,0.9,0,1.6,0,1.8c0,0,0,0,0,0.1h4c0.5,0,1-0.5,1-1V1C14,0.5,13.5,0,13,0z"/>
</svg>
GitHub</a></li>
    </ul>
</aside>


<div class="container">
	<div class="row">
		<div class="col-md-3 col-sm-3 col-xs-12">
					<div class="docs-sidebar hidden-print affix-top" role="complementary">
			<hr>
			<h3>Release Notes</h3>
			<ul class="nav">
				<li>
					<a href="/documents/releasenotes/v11x.html">1.1.x</a>
					<a href="/documents/releasenotes/v10x.html">1.0.x</a>
				</li>
			</ul>
			<hr>
			<h3>Getting Started</h3>
							<ul class="nav">
							<li>
								<a href="/documents/gettingStarted/">Intro</a>
						    </li>
							<li>
								<a href="/documents/networking/features.html">Features</a>
						    </li>
								<li>
									<a href="https://github.com/contiv/install/blob/master/README.md">Installation</a>
									</li>
						    <li>
								<a href="/documents/networking/">Contiv Networking Concepts</a>
						    </li>
								</ul>
									<hr>
			<h3>Install Contiv</h3>
			<ul class="nav">
				<li class="active">
					<a href="/documents/install/systemRequirements.html">System Requirements</a>
				</li>
				<li class="active">
				    <a href="/documents/install/kubernetes.html">Contiv on Kubernetes</a>
				</li>
				<li class="active">
				    <a href="/documents/install/legacy_swarm.html">Contiv on Legacy Docker Swarm</a>
			    </li>
			    <li class="active">
				    <a href="/documents/install/swarm_mode.html">Contiv on Docker Swarm Mode</a>
			    </li>		
			    <li class="active">
				    <a href="/documents/install/openshift.html">Contiv on OpenShift</a>
			    </li>
			    <li class="active">
				    <a href="/documents/install/manual.html">Manual Install</a>
			    </li>
			</ul>
			<hr>
			<h3>Configure Contiv</h3>
			<ul class="nav">
				<li>
					<a href="/documents/config/vxlan.html">Overlay Networking</a>
				</li>
				<li>
				    <a href="/documents/config/l2_bridged.html">L2 Bridged</a>
				</li>
				<li>
				    <a href="/documents/config/l3_routing.html">L3 Routed</a>
			    </li>		
			    <li>
				    <a href="/documents/config/aci.html">Cisco ACI</a>
			    </li>
			</ul>
			<hr>
			<h3>Manage Contiv</h3>
			<ul class="nav">
				<li>
					<a href="/documents/admin/index.html">Intro</a>
				</li>
				<li>
				    <a href="/documents/admin/createTenant.html">Managing Tenants</a>
				</li>
				<li>
				    <a href="/documents/admin/manageUsers.html">Managing Users</a>
			    </li>		
			    <li>
				    <a href="/documents/admin/manageAuthorizations.html">Managing Authorizations</a>
			    </li>
			    <li>
				    <a href="/documents/admin/createNodes.html">Managing Nodes</a>
			    </li>
			     <li>
				    <a href="/documents/admin/manageNetworks.html">Managing Networks</a>
			    </li>
			    <li>
				    <a href="/documents/admin/manageLDAP.html">Managing LDAP</a>
			    </li>
			</ul>
				</li>
			</ul>
			<hr>
			<h3>User Guide</h3>
						
					<ul class="nav">
						<li>
								<a href="/documents/networking/policies.html">Policies</a>
						</li>
						<li>
								<a href="/documents/networking/services.html">Service Loadbalancing</a>
						</li>
						<li>
								<a class="hasChildren" href="/documents/networking/physical-networks.html">Physical Networks</a>
								<ul class="nav">
									<li>
											<a href="/documents/networking/bgp.html">L3 Routed Networks</a>
									</li>
									<li>
											<a href="/documents/networking/l2-vlan.html">L2 Bridged Networks</a>
									</li>
									<li>
											<a href="/documents/networking/aci_ug.html">Cisco ACI</a>
									</li>
								</ul>
						</li>
						<li>
								<a href="/documents/networking/ipam.html">IPAM and Service Discovery</a>
						</li>
						<li>
								<a href="/documents/networking/ipv6.html">IPv6</a>
						</li>
					</ul>
				</li>
				
				
			</ul>
			<hr><p>
			<h3>Tutorials and Talks</h3>
				<ul class="nav">
					<li>
						<a href="/documents/tutorials/index.html">Tutorials</a>
					</li>
					<li>
						<a href="/documents/demos/index.html">Demonstration Videos</a>
					</li>
					<li>
						<a href="/documents/talks/index.html">Community Talks</a>
					</li>
				</ul>
			<hr><p>
			<h3>Examples</h3>
				<ul class="nav">
						</li>
						<li>
							<a href="/documents/samples/mcast.html">Multicast Examples</a>
						</li>
				</ul>
				<hr><p>
			<h3>Community</h3>
				<ul class="nav">
						</li>
						<li>
							<a href="/documents/community/index.html">Contiv Community Examples </a>
						</li>
				</ul>
			<hr><p>
			<h3>Reference</h3>
				<ul class="nav">
					    <li>
					    <a href="/documents/api/wip.html" target="_blank">API Reference</a>
					    </li> 
					    <li>
					    <a href="/documents/reference/netctlcli.html" target="_blank">CLI Reference</a>
					    </li> 
						<li><a href="https://godoc.org/github.com/contiv/contivmodel/client" target="_blank">Go Client Library</a>
						</li>
						
				</ul>
			<hr><p>
		</div>

		</div>  
		<div id="main-content" class="col-sm-9 col-md-9 col-xs-12" role="main">
			<div class="bs-docs-section">
					<h1>Contiv Installation for Kubernetes 1.4+ cluster setup with Kubeadm</h1>

<h2>Prerequisites</h2>

<h3>Proxy Configuration</h3>
<p>export no_proxy=ips of all nodes in cluster,127.0.0.1,localhost,netmaster</p>
<p>If your servers are behind an http proxy, configure the proxy.</p>
<pre class="highlight plaintext"><code>export http_proxy=&lt;proxy_url&gt;
export https_proxy=&lt;proxy_url&gt;

</code></pre>

<h3>Host Name/IP Configuration</h3>

<ol>
<li>Ensure that /etc/hosts has the host name to IP mapping for the host. This IP must be accessible to all the nodes in the Kubernetes cluster.
</li>
<li>Ensure that <a name="hostname"/><a href="#hostname"><code>hostname</code></a>, the host name in <code>/etc/hosts</code> and the environment variable <code>HOSTNAME</code> all point to the same name.
</li>
</ol>

<h3>Kubernetes Installation</h3>

<ul>
<li>Kubernetes 1.4.x, 1.5.x and 1.6.2+ are supported with the following instructions.
</li>
<li>~Kubernetes versions 1.6.0 and 1.6.1 are not supported due to <a href="https://github.com/kubernetes/kubernetes/issues/44041">this issue.</a>
</li>
<li>Install Kubernetes using <a href="http://kubernetes.io/docs/getting-started-guides/kubeadm/">kubeadm</a>:

<ol>
<li>kubeadm installs the latest Kubernetes version. <br>

<ul>
<li>For Kubernetes 1.4, see an example script <a href="https://github.com/contiv/install/blob/master/cluster/k8s1.4/k8smaster.sh">here.</a>
</li>
<li>For Kubernetes 1.6.2+, see an example script <a href="https://github.com/contiv/install/blob/master/cluster/k8s1.6/k8smaster.sh">here.</a>
</li>
</ul>
</li>
<li>Replace step (3/4) in the kubeadm install guide with the following Contiv Installation Instructions. Contiv installation can be done after completing step (4/4) in the Kubeadm installation.
</li>
<li>Ensure that the master nodes have the <code>node-role.kubernetes.io/master</code> taint by running the following command.
<code>
kubectl describe nodes
</code>
<del>Contiv master components are only run on nodes tainted with this annotation as described <a href="https://github.com/contiv/install/blob/master/install/k8s/k8s1.6/contiv.yaml#L254-L258">here</a>. If you are trying to run Contiv on a cluster where the master nodes are tainted differently, the node tolerations &amp; nodeSelector fields need to be changed in all the yaml files in <code>install/k8s/k8s1.6</code> or <code>install/k8s/k8s1.4</code> folders.</del>
</li>
</ol>
</li>
</ul>

<h2>Contiv Installation</h2>

<ul>
<li>Run the following commands from the Kubernetes master host.
</li>
<li>Use curl to get the installer bundle: <br><a name="curl_L_O_https_github_com_contiv_install_releases_download_VERSION_contiv_VERSION_tgz"/><a href="#curl_L_O_https_github_com_contiv_install_releases_download_VERSION_contiv_VERSION_tgz"><code>curl -L -O https://github.com/contiv/install/releases/download/$VERSION/contiv-$VERSION.tgz</code></a>
</li>
<li>Extract the install bundle <br><a name="tar_oxf_contiv_VERSION_tgz"/><a href="#tar_oxf_contiv_VERSION_tgz"><code>tar oxf contiv-$VERSION.tgz</code></a>.
</li>
<li>Change directories to the extracted folder <br><a name="cd_contiv_VERSION"/><a href="#cd_contiv_VERSION"><code>cd contiv-$VERSION</code></a>
</li>
<li>To install Contiv with VXLAN:<br> <a name="sudo_install_k8s_install_sh_n_CONTIV_MASTER"/><a href="#sudo_install_k8s_install_sh_n_CONTIV_MASTER"><code>sudo ./install/k8s/install.sh -n $CONTIV_MASTER</code></a>
</li>
<li><strong>NOTE:</strong> Use the same IP for CONTIV_MASTER as you use for --api-advertise-addresses in kubeadm init.
</li>
<li>To install Contiv specifying a data plane interface for VLAN:<br> <a name="sudo_install_k8s_install_sh_n_CONTIV_MASTER_v_lt_data_plane_interface_like_eth1_gt_"/><a href="#sudo_install_k8s_install_sh_n_CONTIV_MASTER_v_lt_data_plane_interface_like_eth1_gt_"><code>sudo ./install/k8s/install.sh -n $CONTIV_MASTER -v &lt;data plane interface like eth1&gt;</code></a>
</li>
<li><strong>NOTE:</strong> Ensure that the data plane interface is the same on all the worker nodes.
</li>
<li>To install Contiv with ACI: <br><code>./install/k8s/install.sh -n $CONTIV_MASTER -a &lt;APIC URL&gt; -u &lt;APIC User&gt; -p &lt;APIC Password&gt; -l &lt;Leaf Nodes&gt; -d &lt;Physical Domain&gt; -e &lt;EPG Bridge domain&gt; -m &lt;APIC contracts unrestricted mode&gt;
</code> <br> For example: <br> <code>./install/k8s/install.sh -n &lt;netmaster DNS/IP&gt; -a https://apic_host:443 -u apic_user -p apic_password -l topology/pod-xxx/node-xxx -d phys_domain -e not_specified -m no
</code>
<br> where <a name="_CONTIV_MASTER"/><a href="#_CONTIV_MASTER"><code>$CONTIV_MASTER</code></a> is the Contiv proxy or Net Master IP.
</li>
<li>To install Contiv with a custom infra network and gateway: <br><a name="_install_k8s_install_sh_n_lt_netmaster_DNS_IP_gt_g_lt_GATEWAY_IP_gt_i_lt_SUBNET_gt_"/><a href="#_install_k8s_install_sh_n_lt_netmaster_DNS_IP_gt_g_lt_GATEWAY_IP_gt_i_lt_SUBNET_gt_"><code>./install/k8s/install.sh -n &lt;netmaster DNS/IP&gt; -g &lt;GATEWAY IP&gt; -i &lt;SUBNET&gt;</code></a>
</li>
<li>To see additional install options, run <br> <a name="_install_ansible_install_sh"/><a href="#_install_ansible_install_sh"><code>./install/ansible/install.sh</code></a>.
</li>
</ul>

<h2>Removing Contiv</h2>

<ul>
<li>To uninstall Contiv, retaining the etcd state, run:<br>
<a name="sudo_install_k8s_uninstall_sh"/><a href="#sudo_install_k8s_uninstall_sh"><code>sudo ./install/k8s/uninstall.sh</code></a>
</li>
<li>To uninstall Contiv, cleaning up the etcd state, run:<br>
<a name="sudo_install_k8s_uninstall_sh_etcd_cleanup"/><a href="#sudo_install_k8s_uninstall_sh_etcd_cleanup"><code>sudo ./install/k8s/uninstall.sh etcd-cleanup</code></a>. <br>Use this option to cleanup all the Contiv network state. 
</li>
<li>To stop Contiv, go to the install folder contiv-$VERSION and run:<br> <a name="kubectl_delete_f_contiv_yaml"/><a href="#kubectl_delete_f_contiv_yaml"><code>kubectl delete -f .contiv.yaml</code></a>
</li>
<li>To start Contiv, go to the install folder contiv-$VERSION and run:<br> <a name="kubectl_apply_f_contiv_yaml"/><a href="#kubectl_apply_f_contiv_yaml"><code>kubectl apply -f .contiv.yaml</code></a>
</li>
<li>To remove etcd state when Contiv is stopped, run: <br> <a name="rm_rf_var_etcd_contiv_data"/><a href="#rm_rf_var_etcd_contiv_data"><code>rm -rf /var/etcd/contiv-data</code></a>
</li>
</ul>

	<hr>

			</div>
		</div>
	</div>
</div>


<div class="row">
    <div class="col-md-10 col-md-offset-1">
        <hr>
            <p style="text-align: center"><font color="black">Copyright &copy; 2017 Cisco and/or its affiliates. All rights reserved.</font>
            </p>
    </div>
</div>